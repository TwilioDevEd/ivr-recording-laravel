<!DOCTYPE html><html><head><title>IVR: Call screening and Voicemail</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="IVR: Call screening and Voicemail"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">IVR: Call screening and Voicemail</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>IVRs (interactive voice response) are automated phone systems that can facilitate communication between callers and businesses. In this tutorial you will learn how to screen and send callers to voicemail if an agent is busy.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="IVR Phone Tree" class="chapter"><div data-file="app/Http/routes.php" class="step"><h2 id="about-this-application">About this application</h2>
<p><img src="http://howtodocs.s3.amazonaws.com/logo-et-phone2.png" alt="Extra Terrestrial Phone Home
Service"></p>
<p>This <a href="http://laravel.com/">Laravel</a> sample application is
modeled after a typical call center experience, but with more <a href="https://en.wikipedia.org/wiki/Reese%27s_Pieces#ET:_The_Extra-
Terrestrial">Reese&#39;s
Pieces</a>.</p>
<p>Stranded aliens can call a phone number and receive instructions on how
to get out of earth safely, or call their home planet
directly<a href="http://bit.ly/asogi">.</a> In this tutorial, we&#39;ll show you the
key bits of code that allow an agent to send a caller to voicemail, and
later read transcripts and listen to voicemails.</p>
<p>To run this sample app yourself, <a href="https://github.com/TwilioDevEd/ivr-recording-laravel">download the code and follow the
instructions on GitHub</a>.</p>
<p>Let&#39;s get started! Click the right arrow above to move to the next step
of the tutorial.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/howto/walkthrough/ivr-phone-laravel/php/laravel#0">ET IVR Part One: Phone Trees</a></li>
<li><a href="http://laravel.com/docs/5.1">Laravel documentation</a></li>
<li><a href="https://twilio-php.readthedocs.org/en/latest/#quickstart">The twilio-php helper library Quickstart</a></li>
</ul>
</div><div data-file="app/Http/Controllers/ExtensionController.php" data-highlight="21-30" class="step"><h2 id="route-the-call-to-an-agent">Route the call to an agent</h2>
<p>When our caller chooses a planet we need to figure out where to route the
call. Depending on her input we will route this call to an extension. In
this case an extension will be used to look up an Agent, so any string
can be used to define an extension. </p>
<p>Once we lookup the <code>Agent</code>, we can
<a href="https://www.twilio.com/docs/api/twiml/dial">Dial</a> the agent&#39;s phone
number and try to connect the call. Let&#39;s dive in a little bit more into
how we lookup the Agent.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://twilio-php.readthedocs.org/en/latest/usage/twiml.html">TwiML Creation with twilio-php</a></li>
</ul>
</div><div data-file="app/Http/Controllers/ExtensionController.php" data-highlight="51-69" class="step"><h2 id="looking-up-an-agent">Looking up an Agent</h2>
<p>In this case the Agent model is very simple. The migration used to create it:</p>
<pre><code class="cm-s-monokai lang-php">Schema::create(
    &#39;agents&#39;, function (Blueprint $table) {
        $table-&gt;increments(&#39;id&#39;);
        $table-&gt;string(&#39;phone_number&#39;);
        $table-&gt;string(&#39;extension&#39;);
        $table-&gt;timestamps();
    }
);
</code></pre>
<p>We have a handle or <code>extension</code> that we can use to lookup and Agent, and
we have a <code>phone_number</code> that we will call.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="http://laravel.com/docs/5.1/eloquent#retrieving-single-models">Eloquent: Retrieving Single Models/Aggregates</a></li>
</ul>
</div><div data-file="app/Http/Controllers/ExtensionController.php" data-highlight="32-48" class="step"><h2 id="an-agent-screens-the-call">An agent screens the call</h2>
<p>By passing a <code>url</code> to the <code>Dial</code> &gt; <a href="https://www.twilio.com/docs/api/twiml/number"><code>Number</code></a>
TwiML tag, we are telling Twilio to make a POST request to the
<code>new-call</code> route <em>after</em> the agent has picked up but <em>before</em>
connecting the two parties. </p>
<p>Essentially we are telling Twilio to execute some TwiML that only the
agent will hear. In this case the TwiML instructs the agent to press any
number to accept the call. This is processed through the
<a href="https://www.twilio.com/docs/api/twiml/gather">Gather</a> callback.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/api/twiml/say">TwiML Say verb</a></li>
</ul>
</div><div data-file="app/Http/Controllers/AgentCallController.php" data-highlight="68-106" class="step"><h2 id="connect-the-caller-to-the-agent">Connect the Caller to the Agent</h2>
<p>If the agent responds to the call screen by entering any digit
the response will be processed by our <code>connect-message</code> route
(mapped to <code>showConnectMessage</code>) which will <code>&lt;Say&gt;</code> a quick
message, then continue with the original <code>&lt;Dial&gt;</code> command and
connect the two parties.</p>
<p>If the agent instead does not respond, the processing of the
<code>&lt;Dial&gt;</code> verb will end and Twilio will continue processing the
TwiML document.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/api/twiml/gather#attributes-action">The Gather action attribute</a></li>
</ul>
</div><div data-file="app/Http/Controllers/AgentCallController.php" data-highlight="12-49" class="step"><h2 id="send-the-caller-to-voicemail">Send the Caller to Voicemail</h2>
<p>When Twilio makes a request to our voicemail controller, it will pass a
<a href="https://www.twilio.com/docs/api/twiml/dial#attributes-action-dial-call-status-values"><code>DialCallStatus</code></a>
which will tell us if the call was successful. If it was &quot;completed&quot; we
hangup â€” otherwise we need to <code>&lt;Say&gt;</code> a quick prompt and then
<a href="https://www.twilio.com/docs/api/twiml/record"><code>&lt;Record&gt;</code></a> a voicemail from
the caller. </p>
<p>We also specify an <code>action</code> for <code>&lt;Record&gt;</code>. This route will be
called after the call (and hence the recording) has finished. The route
will response &quot;Goodbye&quot; and then <code>&lt;Hangup&gt;</code>.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/api/twiml/twilio_request#synchronous-request-parameters">Twilio Request
parameters</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/hangup">The TwiML Hangup verb</a></li>
</ul>
</div><div data-file="app/Http/Controllers/AgentCallController.php" data-highlight="29-37" class="step"><h2 id="record-the-caller">Record the Caller</h2>
<p>When we tell Twilio to Record we have a few
<a href="https://www.twilio.com/docs/api/twiml/record#attributes">options</a> we can
pass to the <code>Record</code> verb. </p>
<p>Here we instruct Record to stop the recording at 20 seconds, to
<a href="https://www.twilio.com/docs/api/twiml/record#attributes-transcribe"><code>transcribe</code></a>
the call, and where to send the transcription when it&#39;s
complete. Adding the <code>transcribeCallback</code> attribute to
<code>&lt;Record&gt;</code> implies <code>&#39;transcribe&#39; =&gt; true</code>.</p>
<p>Notice we redirect to an URL that is specific to an agent. This
is a convenient way to specify which agent was called to produce
this voice message. This way we can also save the associated
agent together with the voicemail.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/api/twiml/record#attributes-transcribe-callback">Twilio transcribeCallback</a></li>
<li><a href="http://laravel.com/docs/master/routing#route-parameters">Route parameters</a></li>
</ul>
</div><div data-file="app/Http/Controllers/RecordingController.php" class="step"><h2 id="view-an-agent-s-voicemails">View an Agent&#39;s Voicemails</h2>
<p>Once we look up the Agent, all we need to do is display all of
her recordings. We simply bind the recordings to a view that is
then rendered.</p>
<p>It is possible to look up recordings via the Twilio REST API,
but since we have all of the data we need is in the
<code>transcribeCallback</code> request we can easily store it ourselves
and save a roundtrip.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/api/rest/recording">Twilio REST API: Recordings</a></li>
<li><a href="https://www.twilio.com/docs/api/rest/transcription">Twilio REST API: Transcription Resource</a></li>
</ul>
</div><div class="step"><h2 id="where-to-next-">Where to next?</h2>
<p>That&#39;s it! We&#39;ve just implemented an IVR with real Agents, call
screening and voicemail. If you&#39;re a PHP developer working with
Twilio, you might want to check out these other tutorials.</p>
<p><a href="//www.twilio.com/docs/howto/walkthrough/ivr-phone-
tree/php/laravel#0"><strong>Part 1 of this Tutorial: ET Phone Home Service - IVR Phone
Trees</strong></a></p>
<p>Increase your rate of response by automating the workflows that
are key to your business.</p>
<p><a href="https://www.twilio.com/docs/howto/walkthrough/appointment-
reminders/php/laravel"><strong>Appointment
Reminders</strong></a></p>
<p>Send your customers a text message when they have an upcoming
appointment - this tutorial shows you how to do it from a
background job.</p>
<h3 id="did-this-help-">Did this help?</h3>
<p>Thanks for checking out this tutorial! If you have any feedback
to share with us, we&#39;d love to hear it. Tweet
<a href="http://twitter.com/twilio">@twilio</a> to let us know what you
think.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="app/Http/routes.php" data-mode="php">PD9waHAKCi8qCnwtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQp8IEFwcGxpY2F0aW9uIFJvdXRlcwp8LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KfAp8IEhlcmUgaXMgd2hlcmUgeW91IGNhbiByZWdpc3RlciBhbGwgb2YgdGhlIHJvdXRlcyBmb3IgYW4gYXBwbGljYXRpb24uCnwgSXQncyBhIGJyZWV6ZS4gU2ltcGx5IHRlbGwgTGFyYXZlbCB0aGUgVVJJcyBpdCBzaG91bGQgcmVzcG9uZCB0bwp8IGFuZCBnaXZlIGl0IHRoZSBjb250cm9sbGVyIHRvIGNhbGwgd2hlbiB0aGF0IFVSSSBpcyByZXF1ZXN0ZWQuCnwKKi8KUm91dGU6Omdyb3VwKAogICAgWydwcmVmaXgnID0+ICdpdnInLCAnbWlkZGxld2FyZScgPT4gJ3N0YXJSZXR1cm4nXSwgZnVuY3Rpb24gKCkgewogICAgICAgIFJvdXRlOjpwb3N0KAogICAgICAgICAgICAnL3dlbGNvbWUnLCBbCiAgICAgICAgICAgICAgICAnYXMnID0+ICd3ZWxjb21lJywKICAgICAgICAgICAgICAgICd1c2VzJyA9PiAnSXZyQ29udHJvbGxlckBzaG93V2VsY29tZScKICAgICAgICAgICAgXQogICAgICAgICk7CiAgICAgICAgUm91dGU6OmdldCgKICAgICAgICAgICAgJy9tYWluLW1lbnUnLCBbCiAgICAgICAgICAgICAgICAnYXMnID0+ICdtYWluLW1lbnUnLAogICAgICAgICAgICAgICAgJ3VzZXMnID0+ICdNYWluTWVudUNvbnRyb2xsZXJAc2hvd01lbnVSZXNwb25zZScKICAgICAgICAgICAgXQogICAgICAgICk7CiAgICAgICAgUm91dGU6OmdldCgKICAgICAgICAgICAgJy9tYWluLW1lbnUtcmVkaXJlY3QnLCBbCiAgICAgICAgICAgICAgICAnYXMnID0+ICdtYWluLW1lbnUtcmVkaXJlY3QnLAogICAgICAgICAgICAgICAgJ3VzZXMnID0+ICdNYWluTWVudUNvbnRyb2xsZXJAc2hvd01haW5NZW51UmVkaXJlY3QnCiAgICAgICAgICAgIF0KICAgICAgICApOwogICAgICAgIFJvdXRlOjpnZXQoCiAgICAgICAgICAgICcvZXh0ZW5zaW9uJywgWwogICAgICAgICAgICAgICAgJ2FzJyA9PiAnZXh0ZW5zaW9uLWNvbm5lY3Rpb24nLAogICAgICAgICAgICAgICAgJ3VzZXMnID0+ICdFeHRlbnNpb25Db250cm9sbGVyQHNob3dFeHRlbnNpb25Db25uZWN0aW9uJwogICAgICAgICAgICBdCiAgICAgICAgKTsKICAgICAgICBSb3V0ZTo6cG9zdCgKICAgICAgICAgICAgJy9hZ2VudC97YWdlbnR9L2NhbGwnLCBbCiAgICAgICAgICAgICAgICAnYXMnID0+ICduZXctY2FsbCcsCiAgICAgICAgICAgICAgICAndXNlcycgPT4gJ0FnZW50Q2FsbENvbnRyb2xsZXJAbmV3Q2FsbCcKICAgICAgICAgICAgXQogICAgICAgICk7CiAgICAgICAgUm91dGU6OnBvc3QoCiAgICAgICAgICAgICcvYWdlbnQvc2NyZWVuLWNhbGwnLCBbCiAgICAgICAgICAgICAgICAnYXMnID0+ICdzY3JlZW4tY2FsbCcsCiAgICAgICAgICAgICAgICAndXNlcycgPT4gJ0FnZW50Q2FsbENvbnRyb2xsZXJAc2NyZWVuQ2FsbCcKICAgICAgICAgICAgXQogICAgICAgICk7CiAgICAgICAgUm91dGU6OmdldCgKICAgICAgICAgICAgJy9hZ2VudC9jb25uZWN0LW1lc3NhZ2UnLCBbCiAgICAgICAgICAgICAgICAnYXMnID0+ICdjb25uZWN0LW1lc3NhZ2UnLAogICAgICAgICAgICAgICAgJ3VzZXMnID0+ICdBZ2VudENhbGxDb250cm9sbGVyQHNob3dDb25uZWN0TWVzc2FnZScKICAgICAgICAgICAgXQogICAgICAgICk7CiAgICAgICAgUm91dGU6OmdldCgKICAgICAgICAgICAgJy9hZ2VudC9oYW5ndXAnLCBbCiAgICAgICAgICAgICAgICAnYXMnID0+ICdoYW5ndXAnLAogICAgICAgICAgICAgICAgJ3VzZXMnID0+ICdBZ2VudENhbGxDb250cm9sbGVyQHNob3dIYW5ndXAnCiAgICAgICAgICAgIF0KICAgICAgICApOwogICAgICAgIFJvdXRlOjpwb3N0KAogICAgICAgICAgICAnL2FnZW50L3thZ2VudH0vcmVjb3JkaW5nJywgWwogICAgICAgICAgICAgICAgJ2FzJyA9PiAnc3RvcmUtcmVjb3JkaW5nJywKICAgICAgICAgICAgICAgICd1c2VzJyA9PiAnUmVjb3JkaW5nQ29udHJvbGxlckBzdG9yZVJlY29yZGluZycKICAgICAgICAgICAgXQogICAgICAgICk7CiAgICB9Cik7ClJvdXRlOjpnZXQoCiAgICAnL3JlY29yZGluZycsIFsKICAgICAgICAnYXMnID0+ICdhZ2VudC1yZWNvcmRpbmdzJywKICAgICAgICAndXNlcycgPT4gJ1JlY29yZGluZ0NvbnRyb2xsZXJAaW5kZXhCeUFnZW50JwogICAgXQopOwpSb3V0ZTo6Z2V0KAogICAgJy8nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPnZpZXcoJ2luc3RydWN0aW9ucycpOwogICAgfQopOw==</textarea>
<textarea class="saurus-file" data-file="app/Http/Controllers/ExtensionController.php" data-mode="php">PD9waHAKCm5hbWVzcGFjZSBBcHBcSHR0cFxDb250cm9sbGVyczsKCnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIElsbHVtaW5hdGVcRGF0YWJhc2VcRWxvcXVlbnRcTW9kZWxOb3RGb3VuZEV4Y2VwdGlvbjsKdXNlIEFwcFxIdHRwXFJlcXVlc3RzOwp1c2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcQ29udHJvbGxlcjsKdXNlIEFwcFxBZ2VudDsKdXNlIFNlcnZpY2VzX1R3aWxpb19Ud2ltbDsKCmNsYXNzIEV4dGVuc2lvbkNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIC8qKgogICAgICogUmVzcG9uZHMgd2l0aCBhIDxEaWFsPiB0byB0aGUgY2FsbGVyJ3MgcGxhbmV0CiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzaG93RXh0ZW5zaW9uQ29ubmVjdGlvbihSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRzZWxlY3RlZE9wdGlvbiA9ICRyZXF1ZXN0LT5pbnB1dCgnRGlnaXRzJyk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRhZ2VudCA9ICR0aGlzLT5fZ2V0QWdlbnRGb3JEaWdpdCgkc2VsZWN0ZWRPcHRpb24pOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoTW9kZWxOb3RGb3VuZEV4Y2VwdGlvbiAkZSl7CiAgICAgICAgICAgIHJldHVybiByZWRpcmVjdCgpLT5yb3V0ZSgnbWFpbi1tZW51LXJlZGlyZWN0Jyk7CiAgICAgICAgfQoKICAgICAgICAkbnVtYmVyVG9EaWFsID0gJGFnZW50LT5waG9uZV9udW1iZXI7CgogICAgICAgICRyZXNwb25zZSA9IG5ldyBTZXJ2aWNlc19Ud2lsaW9fVHdpbWw7CiAgICAgICAgJHJlc3BvbnNlLT5zYXkoCiAgICAgICAgICAgICJZb3UnbGwgYmUgY29ubmVjdGVkIHNob3J0bHkgdG8geW91ciBwbGFuZXQuICIgLgogICAgICAgICAgICAkdGhpcy0+X3RoYW5rWW91TWVzc2FnZSwKICAgICAgICAgICAgWyd2b2ljZScgPT4gJ2FsaWNlJywgJ2xhbmd1YWdlJyA9PiAnZW4tR0InXQogICAgICAgICk7CgogICAgICAgICRkaWFsQ29tbWFuZCA9ICRyZXNwb25zZS0+ZGlhbCgKICAgICAgICAgICAgWydhY3Rpb24nID0+IHJvdXRlKCduZXctY2FsbCcsIFsnYWdlbnQnID0+ICRhZ2VudC0+aWRdLCBmYWxzZSksCiAgICAgICAgICAgICAnbWV0aG9kJyA9PiAnUE9TVCddCiAgICAgICAgKTsKICAgICAgICAkZGlhbENvbW1hbmQtPm51bWJlcigKICAgICAgICAgICAgJG51bWJlclRvRGlhbCwKICAgICAgICAgICAgWyd1cmwnID0+IHJvdXRlKCdzY3JlZW4tY2FsbCcsIFtdLCBmYWxzZSldCiAgICAgICAgKTsKCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KCiAgICBwcml2YXRlIGZ1bmN0aW9uIF9nZXRBZ2VudEZvckRpZ2l0KCRkaWdpdCkKICAgIHsKICAgICAgICAkcGxhbmV0RXh0ZW5zaW9ucyA9IFsKICAgICAgICAgICAgJzInID0+ICdCcm9kbycsCiAgICAgICAgICAgICczJyA9PiAnRGFnb2JhaCcsCiAgICAgICAgICAgICc0JyA9PiAnT29iZXInCiAgICAgICAgXTsKICAgICAgICAkcGxhbmV0RXh0ZW5zaW9uRXhpc3RzID0gaXNzZXQoJHBsYW5ldEV4dGVuc2lvbnNbJGRpZ2l0XSk7CgogICAgICAgIGlmICgkcGxhbmV0RXh0ZW5zaW9uRXhpc3RzKSB7CiAgICAgICAgICAgICRhZ2VudCA9IEFnZW50Ojp3aGVyZSgKICAgICAgICAgICAgICAgICdleHRlbnNpb24nLCAnPScsICRwbGFuZXRFeHRlbnNpb25zWyRkaWdpdF0KICAgICAgICAgICAgKS0+Zmlyc3RPckZhaWwoKTsKCiAgICAgICAgICAgIHJldHVybiAkYWdlbnQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE1vZGVsTm90Rm91bmRFeGNlcHRpb247CiAgICAgICAgfQogICAgfQp9Cg==</textarea>
<textarea class="saurus-file" data-file="app/Http/Controllers/AgentCallController.php" data-mode="php">PD9waHAKCm5hbWVzcGFjZSBBcHBcSHR0cFxDb250cm9sbGVyczsKCnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIEFwcFxIdHRwXFJlcXVlc3RzOwp1c2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcQ29udHJvbGxlcjsKdXNlIFNlcnZpY2VzX1R3aWxpb19Ud2ltbDsKCmNsYXNzIEFnZW50Q2FsbENvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIC8qKgogICAgICogSGFuZGxlcyB0aGUgY2FsbGJhY2sgYWZ0ZXIgYSBjYWxsIGhhcyBmaW5pc2hlZAogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gbmV3Q2FsbChSZXF1ZXN0ICRyZXF1ZXN0LCAkYWdlbnRJZCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSBuZXcgU2VydmljZXNfVHdpbGlvX1R3aW1sOwogICAgICAgICRjYWxsU3RhdHVzID0gJHJlcXVlc3QtPmlucHV0KCdEaWFsQ2FsbFN0YXR1cycpOwoKICAgICAgICBpZiAoJGNhbGxTdGF0dXMgIT09ICdjb21wbGV0ZWQnKSB7CiAgICAgICAgICAgICRyZXNwb25zZS0+c2F5KAogICAgICAgICAgICAgICAgJ0l0IGFwcGVhcnMgdGhhdCBubyBhZ2VudCBpcyBhdmFpbGFibGUuICcgLgogICAgICAgICAgICAgICAgJ1BsZWFzZSBsZWF2ZSBhIG1lc3NhZ2UgYWZ0ZXIgdGhlIGJlZXAnLAogICAgICAgICAgICAgICAgWyd2b2ljZScgPT4gJ2FsaWNlJywgJ2xhbmd1YWdlJyA9PiAnZW4tR0InXQogICAgICAgICAgICApOwoKICAgICAgICAgICAgJHJlc3BvbnNlLT5yZWNvcmQoCiAgICAgICAgICAgICAgICBbJ21heExlbmd0aCcgPT4gJzIwJywKICAgICAgICAgICAgICAgICAnbWV0aG9kJyA9PiAnR0VUJywKICAgICAgICAgICAgICAgICAnYWN0aW9uJyA9PiByb3V0ZSgnaGFuZ3VwJywgW10sIGZhbHNlKSwKICAgICAgICAgICAgICAgICAndHJhbnNjcmliZUNhbGxiYWNrJyA9PiByb3V0ZSgKICAgICAgICAgICAgICAgICAgICAgJ3N0b3JlLXJlY29yZGluZycsIFsnYWdlbnQnID0+ICRhZ2VudElkXSwgZmFsc2UKICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAkcmVzcG9uc2UtPnNheSgKICAgICAgICAgICAgICAgICdObyByZWNvcmRpbmcgcmVjZWl2ZWQuIEdvb2RieWUnLAogICAgICAgICAgICAgICAgWyd2b2ljZScgPT4gJ2FsaWNlJywgJ2xhbmd1YWdlJyA9PiAnZW4tR0InXQogICAgICAgICAgICApOwogICAgICAgICAgICAkcmVzcG9uc2UtPmhhbmd1cCgpOwoKICAgICAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAiT2siOwogICAgfQoKICAgIC8qKgogICAgICogUmVwbGllcyB3aXRoIGEgaGFuZ3VwCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzaG93SGFuZ3VwKCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSBuZXcgU2VydmljZXNfVHdpbGlvX1R3aW1sOwogICAgICAgICRyZXNwb25zZS0+c2F5KAogICAgICAgICAgICAnVGhhbmtzIGZvciB5b3VyIG1lc3NhZ2UuIEdvb2RieWUnLAogICAgICAgICAgICBbJ3ZvaWNlJyA9PiAnYWxpY2UnLCAnbGFuZ3VhZ2UnID0+ICdlbi1HQiddCiAgICAgICAgKTsKICAgICAgICAkcmVzcG9uc2UtPmhhbmd1cCgpOwoKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIC8qKgogICAgICogSGFuZGxlcyB0aGUgY2FsbGJhY2sgZnJvbSBzY3JlZW5pbmcgYSBjYWxsCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzY3JlZW5DYWxsKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJGN1c3RvbWVyUGhvbmVOdW1iZXIgPSAkcmVxdWVzdC0+aW5wdXQoJ0Zyb20nKTsKICAgICAgICAkc3BlbGxlZFBob25lTnVtYmVyID0gam9pbignLCcsIHN0cl9zcGxpdCgkY3VzdG9tZXJQaG9uZU51bWJlcikpOwoKICAgICAgICAkcmVzcG9uc2UgPSBuZXcgU2VydmljZXNfVHdpbGlvX1R3aW1sOwogICAgICAgICRnYXRoZXIgPSAkcmVzcG9uc2UtPmdhdGhlcigKICAgICAgICAgICAgWydudW1EaWdpdHMnID0+IDEsCiAgICAgICAgICAgICAnYWN0aW9uJyA9PiByb3V0ZSgnY29ubmVjdC1tZXNzYWdlJywgW10sIGZhbHNlKSwKICAgICAgICAgICAgICdtZXRob2QnID0+ICdHRVQnCiAgICAgICAgICAgIF0KICAgICAgICApOwogICAgICAgICRnYXRoZXItPnNheSgnWW91IGhhdmUgYW4gaW5jb21pbmcgY2FsbCBmcm9tOiAnKTsKICAgICAgICAkZ2F0aGVyLT5zYXkoJHNwZWxsZWRQaG9uZU51bWJlcik7CiAgICAgICAgJGdhdGhlci0+c2F5KCdQcmVzcyBhbnkga2V5IHRvIGFjY2VwdCcpOwoKICAgICAgICAkcmVzcG9uc2UtPnNheSgnU29ycnkuIERpZCBub3QgZ2V0IHlvdXIgcmVzcG9uc2UnKTsKICAgICAgICAkcmVzcG9uc2UtPmhhbmd1cCgpOwoKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIC8qKgogICAgICogU2F5cyBtZXNzYWdlIGR1cmluZyBjb25uZWN0aW9uIGJldHdlZW4gYWdlbnQgYW5kIGN1c3RvbWVyIChFVCkKICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNob3dDb25uZWN0TWVzc2FnZShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXNwb25zZSA9IG5ldyBTZXJ2aWNlc19Ud2lsaW9fVHdpbWw7CiAgICAgICAgJHJlc3BvbnNlLT5zYXkoJ0Nvbm5lY3RpbmcgeW91IHRvIHRoZSBleHRyYXRlcnJlc3RyaWFsIGluIGRpc3RyZXNzJyk7CgogICAgICAgIHJldHVybiAkcmVzcG9uc2U7CiAgICB9Cn0K</textarea>
<textarea class="saurus-file" data-file="app/Http/Controllers/RecordingController.php" data-mode="php">PD9waHAKCm5hbWVzcGFjZSBBcHBcSHR0cFxDb250cm9sbGVyczsKCnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIEFwcFxIdHRwXFJlcXVlc3RzOwp1c2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcQ29udHJvbGxlcjsKdXNlIEFwcFxSZWNvcmRpbmc7CnVzZSBBcHBcQWdlbnQ7CgpjbGFzcyBSZWNvcmRpbmdDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7CgogICAgLyoqCiAgICAgKiBTaG93cyBhbiBpbmRleCBvZiBleGlzdGluZ3MgcmVjb3JkaW5ncwogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXhCeUFnZW50KFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJGFnZW50TnVtYmVyID0gJHJlcXVlc3QtPmlucHV0KCdhZ2VudE51bWJlcicpOwogICAgICAgICRhZ2VudE51bWJlckluRTE2NEZvcm1hdCA9ICcrJyAuICRhZ2VudE51bWJlcjsKCiAgICAgICAgJGFnZW50ID0gQWdlbnQ6OndoZXJlKFsncGhvbmVfbnVtYmVyJyA9PiAkYWdlbnROdW1iZXJJbkUxNjRGb3JtYXRdKQogICAgICAgICAgICAgICAtPmZpcnN0T3JGYWlsKCk7CiAgICAgICAgJGFsbFJlY29yZGluZ3MgPSBSZWNvcmRpbmc6OndoZXJlKFsnYWdlbnRfaWQnID0+ICRhZ2VudC0+aWRdKS0+Z2V0KCk7CgogICAgICAgIHJldHVybiByZXNwb25zZSgpLT52aWV3KAogICAgICAgICAgICAncmVjb3JkaW5ncy5pbmRleCcsCiAgICAgICAgICAgIFsncmVjb3JkaW5ncycgPT4gJGFsbFJlY29yZGluZ3MsCiAgICAgICAgICAgICAnYWdlbnQnID0+ICRhZ2VudF0KICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgYSBuZXcgcmVjb3JkaW5nIGZyb20gY2FsbGJhY2sKICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlUmVjb3JkaW5nKFJlcXVlc3QgJHJlcXVlc3QsICRhZ2VudElkKQogICAgewogICAgICAgICRuZXdSZWNvcmRpbmcgPSBuZXcgUmVjb3JkaW5nKAogICAgICAgICAgICBbJ2NhbGxlcl9udW1iZXInID0+ICRyZXF1ZXN0LT5pbnB1dCgnQ2FsbGVyJyksCiAgICAgICAgICAgICAndHJhbnNjcmlwdGlvbicgPT4gJHJlcXVlc3QtPmlucHV0KCdUcmFuc2NyaXB0aW9uVGV4dCcpLAogICAgICAgICAgICAgJ3JlY29yZGluZ191cmwnID0+ICRyZXF1ZXN0LT5pbnB1dCgnUmVjb3JkaW5nVXJsJyksCiAgICAgICAgICAgICAnYWdlbnRfaWQnICAgICAgPT4gJGFnZW50SWRdCiAgICAgICAgKTsKCiAgICAgICAgJG5ld1JlY29yZGluZy0+c2F2ZSgpOwoKICAgICAgICByZXR1cm4gIlJlY29yZGluZyBzYXZlZCI7CiAgICB9Cn0K</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/ivr-recording-laravel" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>